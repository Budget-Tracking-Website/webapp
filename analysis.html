<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Transaction History</title>

<!-- Include the jsPDF library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.3/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
<!-- Include html2canvas library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
<!-- Include Chart.js library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>


<style>
    /* Your CSS styles here */
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
    }
    .container {
        max-width: 600px;
        margin: 20px auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    #top {
        background-color: #999;
    }
    h1 {
        text-align: center;
        margin-bottom: 20px;
    }
    ul {
        list-style-type: none;
        padding: 0;
    }
    li {
        border-bottom: 1px solid #eee;
        padding: 10px 0;
    }
    .transaction {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .monthlyTransaction {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #f4f4f4; /* Light gray background color */
        padding: 10px;
        /* margin-bottom: 1px; */
        border-radius: 5px;
    }
    .amount {
        font-weight: bold;
    }
    .date {
        color: #999;
    }
    .positive-amount {
        color: green;
    }
    /* css for export button */

    /* Your CSS styles here */
    .button-container {
        display: flex;
        justify-content: center;
        margin-top: 20px;
    }

    .button {
        padding: 10px 20px;
        background-color: rgb(58, 61, 62);
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    .button:hover {
        background-color: #0056b3;
    }

    .button + .button {
        margin-left: 20%; /* Set the distance between buttons here */
    }

</style>

</head>
    <body>
        <header class="container" id="top">
            <h1>Transaction History</h1>    

            <div class="button-container">
                <button class="button" onclick = "window.location.href = 'TransactionHistory.html';">Back</button>
            </div>
        </header>


        <div class="container">
            <canvas id="category-chart"></canvas>
            <canvas id="daily-chart"></canvas>
        </div>
        <script src="transactions.js"></script>
        <script>
            // Calculate total amount for each category
            const categoryTotals = {};
            transactions.forEach(transaction => {
                if (categoryTotals[transaction.category]) {
                    if (transaction.amount<0){
                        categoryTotals[transaction.category] -= transaction.amount;
                    }
                } else {
                    categoryTotals[transaction.category] = transaction.amount;
                }
            });

            const labels = Object.keys(categoryTotals);
            const data = Object.values(categoryTotals);

            const ctx = document.getElementById('category-chart').getContext('2d');
            const chart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Transaction Categories',
                        data: data,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.6)',
                            'rgba(54, 162, 235, 0.6)',
                            'rgba(255, 206, 86, 0.6)',
                            'rgba(75, 192, 192, 0.6)',
                            'rgba(153, 102, 255, 0.6)',
                            'rgba(255, 159, 64, 0.6)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Transactions based on Categories'
                        }
                    }
                }
            });
            

            // For the Expenses per day chart : 

            // Filter transactions for the current month
            const currentDate = new Date();
            const currentMonth = currentDate.getMonth() + 1; // January is 0
            const currentYear = currentDate.getFullYear();
            const filteredTransactions = transactions.filter(transaction => {
                const transactionDate = new Date(transaction.date);
                return transactionDate.getMonth() + 1 === currentMonth && transactionDate.getFullYear() === currentYear;
            });

            // Group transactions by day
            const groupedTransactions = {};
            filteredTransactions.forEach(transaction => {
                const transactionDate = new Date(transaction.date);
                const day = transactionDate.getDate();
                if (groupedTransactions[day]) {
                    groupedTransactions[day].push(transaction);
                } else {
                    groupedTransactions[day] = [transaction];
                }
            });

            // Calculate total amount for each day
            const labels2 = [];
            const data2 = [];
            for (let day in groupedTransactions) {
                labels2.push(day);
                const totalAmount = groupedTransactions[day].reduce((acc, cur) => {
                    if (cur.amount < 0) {
                        return acc - cur.amount;
                    } else {
                        return acc;
                    }
                }, 0);
                data2.push(totalAmount);
            }

            const ctx2 = document.getElementById('daily-chart').getContext('2d');
            const chart2 = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: labels2,
                    datasets: [{
                        label: 'Total Amount',
                        data: data2,
                        fill: false,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1,
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Current month Expenses per day'
                        }
                    }
                }
            });

        </script>



    </body>
</html>
